
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Mocking Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../fixtures/fixtures.html" />
    
    
    <link rel="prev" href="../e2e/e2e.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    README
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../unit/unit.html">
            
                <a href="../unit/unit.html">
            
                    
                    Unit Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../integration/integration.html">
            
                <a href="../integration/integration.html">
            
                    
                    Integration Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../tdd/tdd.html">
            
                <a href="../tdd/tdd.html">
            
                    
                    TDD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../bdd/bdd.html">
            
                <a href="../bdd/bdd.html">
            
                    
                    BDD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../e2e/e2e.html">
            
                <a href="../e2e/e2e.html">
            
                    
                    End to End Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7" data-path="mocking.html">
            
                <a href="mocking.html">
            
                    
                    Mocking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../fixtures/fixtures.html">
            
                <a href="../fixtures/fixtures.html">
            
                    
                    Test Fixtures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../property/property.html">
            
                <a href="../property/property.html">
            
                    
                    Property Based Testing
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Mocking</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="mocks">Mocks</h2>
<p>To view lecture notes for this course, please consult the <a href="https://jbelmont.github.io/software-testing" target="_blank">github-pages</a>.</p>
<h4 id="definition-of-mocks-via-wikipedia-mocks">Definition of Mocks via Wikipedia <a href="https://en.wikipedia.org/wiki/Mock_object" target="_blank">Mocks</a></h4>
<p>In object-oriented programming, mock objects (also can be a unit of work) are simulated objects that mimic the behavior of real objects in controlled ways. A programmer typically creates a mock object to test the behavior of some other object, in much the same way that a car designer uses a crash test dummy to simulate the dynamic behavior of a human in vehicle impacts.</p>
<h4 id="reasons-to-use-mock-objects">Reasons to use Mock Objects</h4>
<p>In a unit test, mock objects can simulate the behavior of complex, real objects and are therefore useful when a real object is impractical or impossible to incorporate into a unit test. If an actual object has any of the following characteristics, it may be useful to use a mock object in its place:
the object supplies non-deterministic results (e.g. the current time or the current temperature);</p>
<p><strong>The Object has states that are difficult to create or reproduce (e.g. a network error);</strong>
<strong>The Object is slow (e.g. a complete database, which would have to be initialized before the test);</strong>
<strong>The Object does not yet exist or may change behavior;</strong>
<strong>The Object would have to include information and methods exclusively for testing purposes (and not for its actual task).</strong></p>
<h4 id="sinonjs-mock-via-explanation-sinon-mocks">Sinon.js Mock via explanation <a href="http://sinonjs.org/docs/#mocks" target="_blank">Sinon Mocks</a></h4>
<p>Mocks (and mock expectations) are fake methods (like spies) with pre-programmed behavior (like stubs) as well as pre-programmed expectations.
A mock will fail your test if it is not used as expected.</p>
<p>Sinon Documentation discusses when not to use Mocks.
Mocks come with built-in expectations that may fail your test. Thus, they enforce implementation details.
<strong>The rule of thumb is: if you wouldn&#x2019;t add an assertion for some specific call, don&#x2019;t mock it. Use a stub instead.</strong>
<strong>In general you should never have more than one mock (possibly with several expectations) in a single test.</strong></p>
<h4 id="sinonjs-stubs-via-explanation-sinon-stubs">Sinon.js Stubs via explanation <a href="http://sinonjs.org/docs/#stubs" target="_blank">Sinon Stubs</a></h4>
<p>Test stubs are functions (spies) with pre-programmed behavior. They support the full test spy API in addition to methods which can be used to alter the stub&#x2019;s behavior.
This is a key point here as well with stubs you get the full spy api but with Mocks you don&apos;t.</p>
<h4 id="sinonjs-spies-via-explanation-sinon-spies">Sinon.js Spies via explanation <a href="http://sinonjs.org/docs/#spies" target="_blank">Sinon Spies</a></h4>
<p>A test spy is a function that records arguments, return value, the value of this and exception thrown (if any) for all its calls.
Test spies are useful to test both callbacks and how certain functions/methods are used throughout the system under test.</p>
<p><em>Sinon has an assertion api that you can reference here <a href="http://sinonjs.org/docs/#assertions" target="_blank">Sinon Assertions</a></em>
<em>You can use either Mocha or Tape.js here it is your choice which one you feel most comfortable with.</em></p>
<h4 id="sinon-has-an-assertion-library-that-you-can-use-but-i-would-recommend-using-either-chaijs-assertion-library-or-shouldjs">Sinon has an assertion library that you can use but I would recommend using either chai.js assertion library or should.js</h4>
<ul>
<li>Chai.js documentation can be found here <a href="http://chaijs.com/api/assert/" target="_blank">Chai.js Assert</a> // <a href="http://chaijs.com/api/bdd/" target="_blank">Chai.js BDD</a></li>
<li>Should.js Assertion library can be found here <a href="http://shouldjs.github.io/" target="_blank">Should.js</a></li>
</ul>
<p><strong>Open program.test.js in <code>mocks-stubs-spies</code> folder</strong></p>
<h4 id="1-stub-the-retrievedocument-function">1. Stub the <code>retrieveDocument</code> function</h4>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">function</span> <span class="token function">retrieveDocument</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>dbName<span class="token punctuation">,</span> name<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> couchDBName <span class="token operator">=</span> nano<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        couchDBName<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You don&apos;t need the implementation here but I included it here for your reference.
Using Sinon check that the retrieveDocument stub is called once.
Make an assertion that the payload and the expected response match.</p>
<h4 id="2-stub-the-insertdocument-function">2. Stub the <code>insertDocument</code> function.</h4>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">function</span> <span class="token function">insertDocument</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dbName <span class="token operator">=</span> <span class="token string">&apos;softwaretesting&apos;</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&apos;users&apos;</span><span class="token punctuation">,</span> body <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> couchDBName <span class="token operator">=</span> nano<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">insertDoc</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dbName<span class="token operator">:</span> couchDBName<span class="token punctuation">,</span> name<span class="token punctuation">,</span> body <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">retrieveDoc</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dbName<span class="token operator">:</span> couchDBName <span class="token punctuation">,</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">insertDoc</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>dbName<span class="token punctuation">,</span> name<span class="token punctuation">,</span> body<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        dbName<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> body<span class="token punctuation">,</span> header</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><em>Again you don&apos;t need the implementation here because you are stubbing it out but I added it in case you are curious.</em></p>
<ul>
<li>Use sinon to make some assertions about the stubbed out function</li>
<li>Remember to use the setup function in tape or the before block in mocha to initialize the stub.</li>
</ul>
<h4 id="3-stub-out-the-deletedocument-function">3. Stub out the <code>deleteDocument</code> function</h4>
<h6 id="implementation-details">Implementation Details</h6>
<pre class="language-"><code class="lang-javascript"><span class="token keyword">function</span> <span class="token function">retrieveDoc</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>dbName<span class="token punctuation">,</span> name<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        dbName<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">deleteDocument</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>dbName<span class="token punctuation">,</span> name<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> couchDBName <span class="token operator">=</span> nano<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">retrieveDoc</span><span class="token punctuation">(</span><span class="token punctuation">{</span>dbName<span class="token operator">:</span> couchDBName<span class="token punctuation">,</span> name<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">body</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> <span class="token punctuation">{</span>
                    _rev
                <span class="token punctuation">}</span> <span class="token operator">=</span> body<span class="token punctuation">;</span>
                couchDBName<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> _rev<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> body<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Stub out the deleteDocument function by using sinon.</li>
<li>Use chai assertions or use the should.js assertion library</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../e2e/e2e.html" class="navigation navigation-prev " aria-label="Previous page: End to End Testing">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../fixtures/fixtures.html" class="navigation navigation-next " aria-label="Next page: Test Fixtures">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Mocking","level":"1.7","depth":1,"next":{"title":"Test Fixtures","level":"1.8","depth":1,"path":"docs/fixtures/fixtures.md","ref":"docs/fixtures/fixtures.md","articles":[]},"previous":{"title":"End to End Testing","level":"1.6","depth":1,"path":"docs/e2e/e2e.md","ref":"docs/e2e/e2e.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["include-codeblock","advanced-emoji","prism","highlight","copy-code-button"],"pluginsConfig":{"prism":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"copy-code-button":{},"advanced-emoji":{"embedEmojis":false},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"default","theme":"chrome","unindent":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"docs/mocking/mocking.md","mtime":"2020-05-18T15:18:16.852Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-05-18T20:30:18.366Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

